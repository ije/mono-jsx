#!/usr/bin/env node

import { readFile, writeFile } from "node:fs/promises";
import process from "node:process";

switch (process.argv[2]) {
  case "setup":
    setup().then(() => {
      console.log("âœ… JSX runtime setup complete.");
    });
    break;
  default:
    process.exit(0);
}

async function setup() {
  let tsConfigPath = globalThis.Deno ? "deno.json" : "tsconfig.json";
  let tsConfig = Object.create(null);
  try {
    const json = await readFile(tsConfigPath, "utf8");
    tsConfig = JSON.parse(json);
  } catch {
    // ignore
  }
  tsConfig.compilerOptions = {
    ...tsConfig.compilerOptions,
    jsx: "react-jsx",
    jsxImportSource: "mono-jsx",
  };
  if (!globalThis.Deno) {
    tsConfig.compilerOptions.allowJs = true
  }
  await writeFile(tsConfigPath, JSON.stringify(tsConfig, null, 2));
}
